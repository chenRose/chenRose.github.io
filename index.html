<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>狼叔博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="狼叔博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="狼叔博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="狼叔博客">
  
    <link rel="alternate" href="/atom.xml" title="狼叔博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">狼叔博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-IP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/08/IP/" class="article-date">
  <time datetime="2017-05-08T08:16:43.805Z" itemprop="datePublished">2017-05-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/08/IP/">IP</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h1><p>##一 服务特点：尽力而为的、无连接的</p>
<p>###1. 尽力而为：<br>    表示它可能发生一些错误，它不会提供任何保证，更不会提供任何可靠性，一切都需要它的上层服务来提供可靠性</p>
<p>###2. 无连接：<br>    表示IP数据报可能不会按序来传递，也可能在复制过程中出现差错。</p>
<p>##二 IPV4和IPV6的头部<br>    1.版本字段(4bit,ipv4为4,ipv6为6，二者唯一相同的字段)</p>
<pre><code>2.IHL(Internet头部长度)ipv4头部长度(4bit:0到15个32位，表示最多个字节，这个限制导致了一些选项不可用p125)IPv6则没有这个选项，因为它是固定的40字节长度  

3.ToS(Type of Server）服务类型字段8bit：现在被分为了两个字段：前6位为服务字段DS，后2位为显式拥塞通知字段或者指示位。（在数据报转发时特殊处理）

4. 总长度字段（16bit：0到65535个字节）：这里有两点需要注意：
    1.这个总长度字段有何意义？-&gt;因为一些带IPv4字段的低层协议不能精确表达自己封闭的数据报大小。
    2.大多数链路层不能携带太大的数据，除非将它分拆成更小的片。
    （主机不需要接收大于576字节的IPv4数据报，而IPv6则可以处理所链接的链路MTU大小的数据报）另外，很多UDP应用也把大小限制为512Byte。
    3.IPv4数据报常被分为多个更小的分片，每个分片是一个独立的IP数据报。
    4.IPv6不支持分片，其长度在负载长度中，但是不包括头部长度（包括负载长度）此外，还有一个越长数数据报选项。
5. 标识字段：标识由IPv4主机发送的数据报16bit：标识是哪一个IPv4数据报的分片。与之关联的还有标注志和13bit的分片偏移。

6. TTL：生存期(经过的路由数量上限，每经过一跳就减1，然后到0时将报丢弃，并使用ICMP消息通知)

7. 协议字段：表示数据报中有效负载部分的数据类型：常用的为UDP17,TCP6,这里提供了多路分解的功能，使得可以携带多种协议类型的有效载荷。p127第一段
8. 头部校验和：IPv4计算的只是它头部的校验和，而不含它的载荷。因此，需要它携带的协议通常自己的检验机制来完成检查。IPv6没有这个字段！理由是因为它更高层协议中已经有相应的检验机制，并且已经包含了它认为的重要数据。而头部的传递位错误比较少见。详细见p127

9.Internet校验和：和觉的CRC循环冗余校验不同

步骤为：它是一个16位字的序列，它计算16位二进制反码和。在计算它的校验和时，可能需要把它本身也算进去，这时候，在运算前将它设置为0，然后计算机出结果后再写入该字段。
接收验证时，计算它的校验和，如果得到的值为0的话，就说明没有错误。否则，出错，但是不会产生任何的差错信息。
（一种更简单的方法见p128）

10. DS字段与ECN字段的意义（旧时，在IPv4中为TOS字段，而在IPv6字段中为流量类别字段）

6位DS字段为64个DSCP，而这通知了路由器对接收的数据进行转发或者特殊处理。不同类型的转发处理表示为每跳行为：PHB 哎呀更详细的看p130吧！
AF和EF比提供的尽力而为服务更好。

11. IPv4中的选项：(可能为40个字节)，但是由于IPv4头部的大小限制和相关的安全问题，有一些是不可用的。而对于IPv6来説，它不是基本头部的一部分，而是在扩展头部中。IP路由器接收到一个包含选项的数据报时，需要对它进行特殊处理，但是通常是由终端主机来处理IPv6的扩展头部。

总结一下：首先两者只有一个位置相同的字段，为版本字段IPv4为4，IPv6为6。
IPv4有IHL字段，而IPv6没有，因为它是固定的。
IPv4和IPv6都有一个DS字段和一个ECN字段，不过位置不同。
IPv4有一个总长度，它包含了头部的长度；而在IPv6中的负载长度中没有包含头部的长度，当然它含有扩展头部的长度。
IPv4有一个协议字段，而IPv6没有，但是它可能通过在IPv6的下一个头部字段来确定
IPv4支持分片，因此它有4个字节的32位的数据来保存这些信息，而后者是没有这个字段的，它有另外的不同的分片方式进行工作。
IPv4有一个TTL，生存期，而在6中， 它叫做跳数限制。
IPv4有头部校验和，而IPv6没有
IPv6有一个“下一个头部 ”字段，8位，但是IPv4则没有。它用来说明，IPv6头部之后，其他的扩展头部的存在和类型，或者是其他协议类型头部。
</code></pre><p>##三、IPv6扩展头部</p>
<pre><code>IPv6形成的头部链，开头是IPv6头部，后面则是一些扩展头部、以及是一些其他的协议头部。

HD:H是分组经过的每一个路由器处理的选项；而D是目的地选项头部。
</code></pre><p>###1.  IPv6选项：<br>    如果选项存在，可以放入逐跳选项HOPORT和目的地选项(它携带在HD扩展头部中)。它们有相同的格式：</p>
<pre><code>**TLV type-length-value**

1. IPv6选项需要与8字节对齐，因此有填充1和填充n来填充
2. 之前説过的**超长数据报**，
3. 隧道封装限制：p136。隧道的封装可以递归，该选项用来控制封装的层数。
4. 路由器警告
5. 快速启动
6. CALIPSO：安全相关的，
7. 家乡地址
</code></pre><p>###2. 其它IPv6扩展头部<br>路由头部：分RH0（被放弃了已经）和RH2：它可以指定数据报通过网络的路径<br>    先聊聊RH0，它已经被放弃了（出于安全方面的考虑），而RH2则被定义为与移动IP共同使用<br>    注意，在RH0中，IPv6基本头部中的目的IP地址字段被修改为包含数据报转发的下一转发地址</p>
<pre><code>路由头部在转发的过程中的变化也是挺有意思的。首先，需要注意的是，指定的路径不用是一整条的，而是可以只指定一部分需要经过的路由即可，这样，它需要根据正常的路由规则到IPv6头部中的dest，当到达了这个dest之后，根据left，即剩余部分的值来确定下一跳的IPv6地址，然后将这个地址与IPv6头部中的dest交换，而交换后的这个在路由头部中的地址就已经没有用了，而这时候，并不会把它“删除”，而是递减这个left，告诉它..下一次交换就应该指向下一个路由了。

另外，RH0的问题，见p139：它允许在路由头部的多个位置指定相同地址。这可能导致流量在一条特定路径上的两台或者多台主机或路由器之间重复转发。大量的流量负载可能会在网络中汕头特定路径创建，与相同路径上的其他流量竞争带宽而造成干扰。
</code></pre><p>分片头部：以前説的IPv6不进行分片，其实是不对的。直接地来説，应该是它的分片相关字段不出现的IP头部，而是作为了扩展头部出现了。另外，它的分片方式和IPv4有极大的不同。见p139 </p>
<p>####2.分片头部的格式：p140</p>
<p>####3.分片的过程：<br>    首先，分片有不可分片部分和可分片部分的区分</p>
<pre><code>然后，每个分片的内容为：原分组的不可分片部分的副本(需要修改的是它的负载长度字段，注意，分片头部8个字节也需要记在内，所有的头部都需要记录在内！)、一个分片头部（分片的偏移、标识符、M标志等，它8个字节）最后才是分片的载荷内容。

注意，偏移量是8字节为单位的，所以分片的长度应该也是以8字节作为边界进行的。最后一个分片可能不是，也可能是(反正这时候也不用去考虑它后面的偏移了)。

最后，接收方以可能非按序的情况接收到所有的分片，将它们重组成原始的数据，来交给上层的协议处理。

分片过程增加的字节数为：（分片数量-1）*不可分片部分的长度+分片数量*8（分片头部的长）

链路层上的开销：还包括一个14字节的头部和4字节的CRC共18字节，每多一个分片就多这些字节。。
</code></pre><p>##四、IP 转发</p>
<pre><code>1. 如果直接相连的主机（点到点）或者共享网络（以太网），将直接发送到目的地
2. 否则，发送到默认路由器

IP协议模块接收一个数据报，可以来自同一主要的一上层协议，如TCP,UDP等，也可以是来自网络接口的数据报。
如果是后者，即是来自网络接口的数据报：IP层会先检查目的地址是否为自己的地址（或者是它可以接收其流量的一个其他地址，如IP广播或者组播地址），如果是，则将根据IP协议中的协议字段（IPv4中的协议字段，或者是IPv7中的下一头部字段指定的协议模块）来转交。否则，它不是转发给自己的，那么就根据IP层是一个路由器还是一个主机来确定下一步的操作了，如果是路由器，则可以转发。如果不是，可能会被默默地丢弃。
</code></pre><p>###1. 转发表信息：<br>    目的地：默认路由可设置为0，完整的路由可设为完整长度的IP地址。<br>    掩码：与数据报目的IP地址按位与，然后与转发表条目中的目的地进行比较。<br>    下一跳：数据报应该转发到的该地址。<br>    接口：确定将数据报发送到下一跳的网络接口（即选择从哪一个网络接口转发出去，如果转发系统也是IP数据报的发送方，也可以用于选择源IP地址）。</p>
<pre><code>另外，使用一些路由协议来进行确保路由表的正确。总不能有环路吧。。。
</code></pre><p>###2. IP转发行动<br>　　1。找匹配项<br>　　2。找最匹配项(mask中1的数量最多的一个条）<br>　　如果没有找到匹配的，则产生一个“主机不可达”的错误，通常会由ICMP返回给发送数据报的主机。<br>　　有时候也可能会找到多个相同的匹配，这时候可能会选择第一个匹配项，也可能会进行一些更复杂的路由平衡负载或者拆分流量等。
　　</p>
<p>###3. 两种交付方式：直接交付(所有系统使用相同的网络前缀)和间接交付p147</p>
<pre><code>需要注意的是：间接交付中，需要把它交给路由器，这时候，IP地址对应着前面的源IP和目的IP，但是低层的地址是不对应的。低层地址决定了哪台机器在每跳的基础上接收包含数据报的帧!!!!

这里，出现了一个“路由器的私有地址和公有地址”，需要进行一个地址转换。嗯。。如果从私有网络上把数据报发送到默认网关后，是需要一个NAT转换，把地址转化为公有地址，向外界隐藏了一些细节。
而经过了NAT转化后转发把公有网络后，就不需要对它再进行NAT了，不过呢。这时候，它可能会存在多个默认路由器了。
另外，IPv6使用的邻居发现协议，还可以来确定它的下一跳的低层地址。 

另外 ，IPv6还分了链路本地地址和全球地址。对于前者，它只能用于同一个链路上。另外，所有的链路本地地址共享相同的IPv6前缀。fe80::/10,在发送一个目的地为链路本地地址的数据报时，一台多宿主主机可能需要用户来决定使用哪个接口。

tracert可以跟踪到一个目的地的路径。它使用的是UDP+ICMP。

另外，MPLS,多协议标签交换，它是一种链路层网络，它能够承载多种网络层协议。
</code></pre><h2 id="五、IP数据报的主机处理"><a href="#五、IP数据报的主机处理" class="headerlink" title="五、IP数据报的主机处理"></a>五、IP数据报的主机处理</h2><h3 id="1-主机模式：强主机模式和弱主机模式p152"><a href="#1-主机模式：强主机模式和弱主机模式p152" class="headerlink" title="1. 主机模式：强主机模式和弱主机模式p152"></a>1. 主机模式：强主机模式和弱主机模式p152</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/08/IP/" data-id="cj2fve3di000098tej9l05lv7" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/08/hello-world/" class="article-date">
  <time datetime="2017-05-08T05:22:27.534Z" itemprop="datePublished">2017-05-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/08/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/08/hello-world/" data-id="cj2fve3dq000198te97nw0ghy" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/05/08/IP/">IP</a>
          </li>
        
          <li>
            <a href="/2017/05/08/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 chenRose<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>